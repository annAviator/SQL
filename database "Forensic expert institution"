--Создание базы данных «Судебно-экспертное учреждение» 

-- Создание таблицы «Лаборатории»
CREATE TABLE Лаборатории
(Название char (20) NOT NULL PRIMARY KEY,
 Телефон char (25) 
);

--Создание таблицы «Сотрудники»
CREATE TABLE Сотрудники
( Таб_номер integer NOT NULL PRIMARY KEY,
Фамилия varchar(35) NOT NULL,
Имя varchar(35) NOT NULL,
Отчество varchar(35) NOT NULL,
Дата_рождения date,
Должность varchar(35),
Специализация varchar(35),
Название varchar(20) REFERENCES Лаборатории
);

--Создание таблицы «Лаборатории»
CREATE TABLE Лаборатории
( Название char(20) NOT NULL PRIMARY KEY,
 Телефон char(25) 
);

--Создание таблицы «Заказчики»
CREATE TABLE Заказчики
( Номер_заказчика integer NOT NULL PRIMARY KEY,
Фамилия_заказчика varchar(35) NOT NULL,
Имя_заказчика varchar(35) NOT NULL,
Отчество_заказчика varchar(35) NOT NULL,
Телефон_заказчика varchar(25) NOT NULL
);


--Создание таблицы «Экспертизы»

CREATE TABLE Экспертизы 
(Номер_экспертизы integer NOT NULL PRIMARY KEY,
Вид varchar(35),
Род varchar(35),
Дата_назначения date,
Дата_окончания date,
Стоимость integer,
Таб_номер integer REFERENCES Сотрудники,
Номер_заказчика integer REFERENCES Заказчики
);


--Создание таблицы «Спец_оборудование»
CREATE TABLE Спец_оборудование
( Код_оборудования integer NOT NULL PRIMARY KEY,
Наименование varchar(35) NOT NULL,
Стоимость_оборудования integer, 
Номер_экспертизы integer REFERENCES Экспертизы
);

-- Заполнение БД
--Таблица «Сотрудники»
INSERT INTO Сотрудники (Таб_номер, Фамилия, Имя, Отчество, Дата_рождения, Должность, Специализация, Название) VALUES (1, 'Иванов', 'Иван', 'Иванович', '12.05.1998',
'эксперт', 'химия', 'Экологической экспертизы');

INSERT INTO Сотрудники (Таб_номер, Фамилия, Имя, Отчество, Дата_рождения, Должность, Специализация, Название) VALUES (2, 'Петров', 'Иван', 'Александрович', 
'14.05.1996', 'эксперт', 'информационные технологии', 'Компьютерно-технической экспертизы');

INSERT INTO Сотрудники (Таб_номер, Фамилия, Имя, Отчество, Дата_рождения, Должность, Специализация, Название) VALUES (3, 'Иванова', 'Мария', 'Ивановна', '12.05.1988', 
'эксперт', 'документоведение', 'Экспертизы документов');

--Таблица «Лаборатории»
INSERT INTO Лаборатории (Название, Телефон) VALUES ('Экологическая экспертиза', 89122340978);

INSERT INTO Лаборатории (Название, Телефон) VALUES ('Видеотехнической экспертизы', 89155779978);

INSERT INTO Лаборатории (Название, Телефон) VALUES ('Компьютерно-технической экспертизы', 89189779236);
--Таблица «Заказчики»
INSERT INTO Заказчики (Номер_заказчика, Фамилия_заказчика, Имя_заказчика, Отчество_заказчика, Телефон_заказчика) VALUES (1, 'Сидоров', 'Олег', 
'Васильевич', 89120239834);

INSERT INTO Заказчики (Номер_заказчика, Фамилия_заказчика, Имя_заказчика, Отчество_заказчика, Телефон_заказчика) VALUES (2, 'Андреев', 'Василий', 
'Петрович', 89120111834);

INSERT INTO Заказчики (Номер_заказчика, Фамилия_заказчика, Имя_заказчика, Отчество_заказчика, Телефон_заказчика) VALUES (3, 'Сидорова', 'Светлана', 
'Викторовна', 89157939834);

-- Таблица «Экспертизы»
INSERT INTO Экспертизы (Номер_экспертизы, Вид, Род, Дата_назначения, Дата_окончания, Стоимость, Таб_номер, Номер_заказчика) VALUES (1, 'Первичная', 
'Экологическая', '12.09.20', '25.09.20', '12000', 1, 4);

INSERT INTO Экспертизы (Номер_экспертизы, Вид, Род, Дата_назначения, Дата_окончания, Стоимость, Таб_номер, Номер_заказчика) VALUES (2, 'Первичная', 
'Компьютерно-техническая', '01.10.20', '07.10.20', '35000', 2, 7);

INSERT INTO Экспертизы (Номер_экспертизы, Вид, Род, Дата_назначения, Дата_окончания, Стоимость, Таб_номер, Номер_заказчика) VALUES (3, 'Повторная', 
'Видеотехническая', '12.09.19', '26.09.19', '45000', 6, 6);

--Таблица «Спец_оборудование»
INSERT INTO Спец_оборудование (Код_оборудования, Наименование, Стоимость_оборудования, Номер_экспертизы) VALUES (1, 'Электронный микроскоп', '270000', 1);

INSERT INTO Спец_оборудование (Код_оборудования, Наименование, Стоимость_оборудования, Номер_экспертизы) VALUES (2, 'Хроматограф', '570000', 1);

INSERT INTO Спец_оборудование (Код_оборудования, Наименование, Стоимость_оборудования, Номер_экспертизы) VALUES (3, 'USB-блокиратор', '170000', 2);


--Запросы к созданной БД
/* запрос на обновление данных в таблице «Лаборатории», заменяющий номер лаборатории видеотехнической экспертизы с «89155779978» на номер «87775431701» */

UPDATE Лаборатории SET Телефон = "87775431701"
WHERE Название = "Видеотехнической экспертизы";

/* запрос на удаление из таблицы «Экспертизы» всех экспертиз, назначенных 19.09.2020 года */

DELETE * FROM Экспертизы
WHERE (((Экспертизы.[Дата_назначения])=#9/19/2020#));

/* запрос, выводящий всех сотрудников лаборатории компьютерно-технической экспертизы */

SELECT Сотрудники.Название, Сотрудники.Фамилия, Сотрудники.Имя, Сотрудники.Отчество FROM Сотрудники
WHERE (((Сотрудники.Название)="Компьютерно-технической экспертизы"));

/* параметрический запрос, выводящий все экспертизы, находящиеся в производстве у эксперта с табельным номером Х (вводится с клавиатуры) */
SELECT Сотрудники.Фамилия, Сотрудники.Имя, Сотрудники.Отчество, Экспертизы.Таб_номер, Экспертизы.Дата_назначения, Экспертизы.Дата_окончания, Экспертизы.Вид,
Экспертизы.Стоимость, Экспертизы.Род FROM Сотрудники INNER JOIN Экспертизы ON Сотрудники.Таб_номер = Экспертизы.Таб_номер
WHERE (((Экспертизы.Таб_номер)=[Введите табельный номер]) AND ((Экспертизы.Дата_окончания) Is Null));

/* сложный запрос, выводящий всех экспертов, которые работают в той же лаборатории, что и эксперт с табельным номером 2 */
SELECT Фамилия, Имя, Отчество, Специализация, Название FROM Сотрудники
WHERE Сотрудники.Название =  (SELECT Название FROM Сотрудники WHERE Таб_номер = 2);

/*сложный запрос, выводящий список специального оборудования, стоимость которого выше средней для экспертного учреждения */
SELECT Наименование, Стоимость_оборудования FROM Спец_оборудование
WHERE Стоимость_оборудования > (SELECT avg(Стоимость_оборудования) FROM Спец_оборудование); 








